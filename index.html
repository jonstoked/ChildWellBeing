
<!DOCTYPE html>
<html>
<head>
	
	<title>Quick Start - Leaflet</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!-- <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" /> -->

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>

	<!-- jon's dependencies -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script>document.write('<script src="http://' + (location.host || '${1:localhost}').split(':')[0] + ':${2:35729}/livereload.js?snipver=1"></' + 'script>')</script>
	<script src="https://fastcdn.org/Papa-Parse/4.1.2/papaparse.min.js"></script>

   <style>
	   html, body, #mapid {
	      height:100%;
	      width:100%;
	      padding:0px;
	      margin:0px;
	   } 
   </style>

</head>

<body>
<div id="mapid"></div>
<script>

	var map, areas;

	setupMap();
	getAreas();

	function setupMap() {

		map = L.map('mapid', {
	    	fullscreenControl: true
		}).setView([33.76, -84.37], 9);

		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.streets'
		}).addTo(map);

	}

	function getAreas() {

		$.get("CWBIndex.csv", function (data) {
	        var csvdata = Papa.parse(data, {header:true,dynamicTyping:true});
	        areas = csvdata["data"]
	        getAreaGeometries()
	    });

	}

    function getAreaGeometries() {

	    areas.forEach(function(area) {
	    	let url = "http://opendata.atlantaregional.com/datasets/daa63723158740898952c93dff03a8f5_118.geojson?where=ZIP='"+ area["Zipcodes"] + "'"
			$.getJSON(url, function(json) {
				console.log(json)
				area["feature"] = json["features"][0]
				area["layer"] = L.geoJSON(area["feature"]).addTo(map);
				// area["layer"].setStyle = {
				//     "fillColor": "#ff0000",
				//     "weight": 5,
				//     "fillOpacity": 1
				// };

			});
	    });

    }











	//takes array of counties
	// function filterCounties(allCounties) {

	// 	counties = allCounties.filter(function (county,n) {
	// 		var name = county["properties"]["NAME10"]
	//         return isCountyMetroAtlanta(name);
 //    	});

 //    	// console.log(countiesFiltered)
 //    	displayCounties();
	// }


</script>

</body>
</html>
